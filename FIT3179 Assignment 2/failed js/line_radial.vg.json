{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Generation",
    "data": {
      "url": "data/suicide_generation.csv"
    },
    "params": [
        {
        "name": "Year_selection",
        "value": 2008,
        "bind": {
            "input": "range",
            "min": 2000,
            "max": 2016,
            "step": 1,
            "name": "Year: "
            }
        }
    ],
    "hconcat": [
      {
        "width": 300,
        "height": 300,
        "data": {"url": "data/suicide_generation.csv"},
        "transform": [
        {
          "aggregate": [{"op": "sum", "field": "suicides_no", "as": "total"}],
          "groupby": ["generation", "year"]
        },
        {"filter": "datum.year == Year_selection"}
        ],
        "layer": [{
            "params": [        
                {
                "name": "Generation",
                "select": {"type": "point", "fields": ["generation"]},
                "bind": "legend"
                },        
                {
                  "name": "area_highlight",
                  "select": {"type": "point", "on": "mouseover"}
                },
                {"name": "gen_select", "select": {"type": "point", "fields": ["generation"]}}
            ],
          "mark": {"type": "arc", "innerRadius": 20, "stroke": "#000000", "cursor": "pointer"},
          "encoding": {
            "color": {"field": "generation", 
                        "type": "nominal",
                    "scale": {"range": ["#1E90FF", "#FFFF00", "#FF69B4", "#FF0000", "#006400", "#9400D3"]},
                "title": "Generation"},
            "opacity": {
                "condition": {"param": "Generation", "value": 1},
                "value": 0.3},
            "fillOpacity": {
                "condition": {"param": "gen_select", "value": 1},
                "value": 0.3
            },    
            "strokeWidth": {
              "condition": [
                {
                  "param": "gen_select",
                  "empty": false,
                  "value": 2
                },
                {
                  "param": "area_highlight",
                  "empty": false,
                  "value": 1
                },
                {
                  "param": "Generation",
                  "empty": false,
                  "value": 1
                }
              ],
              "value": 0
            },
            "tooltip": [
              {"field": "total", "type": "quantitative", "format": ".0f",  "title": "Suicide Number"},
              {"field": "generation", "type": "nominal", "title": "Generation"}
            ]
          }
        },
        {
          "mark": {"type": "text", "radiusOffset": 10},
          "encoding": {
            "text": {"field": "total", "type": "quantitative", "format": ".0f"}
          }
        }],
        "encoding": {
          "theta": {"field": "total", "type": "quantitative", "stack": true},
          "radius": {"field": "total", "scale": {"type": "sqrt", "zero": true, "rangeMin": 20}},
          "color": {
            "field": "generation", 
            "type": "nominal", 
            "condition": {"test": "datum.total == 0", "value": null}
            },
          "opacity": {
            "condition": {"param": "Generation", "value": 1},
            "value": 0.3},
          "fillOpacity": {
            "condition": {"param": "gen_select", "value": 1},
            "value": 0.3}, 
          "tooltip": [
            {"field": "total", "type": "quantitative", "format": ".0f",  "title": "Suicide Number"},
            {"field": "generation", "type": "nominal", "title": "Generation"}
          ]
        }
      },
      {
        "data": {
            "url": "data/suicide_generation.csv"
          },
          "width": 400,
          "height": 300,
          "layer": [
            {
              "encoding": {
                "x": {"field": "year", "type": "ordinal"},
                "y": {"field": "suicide_rate", "type": "quantitative"},
                "color": {"field": "generation", 
                "type": "nominal",
            "scale": {"range": ["#1E90FF", "#FFFF00", "#FF69B4", "#FF0000", "#006400", "#9400D3"]},
              "title": "Generation"},
              "opacity": {
                "condition": {"param": "gen_select", "value": 1},
                "value": 0.3}
              },
              "layer": [
                {"mark": "line"},
                {
                  "params": [{
                    "name": "label",
                    "select": {
                      "type": "point",
                      "encodings": ["x"],
                      "nearest": true,
                      "on": "mouseover"
                    }
                  }],
                  "mark": "point",
                  "encoding": {
                    "opacity": {
                      "condition": {
                        "param": "label",
                        "empty": false,
                        "value": 1
                      },
                      "value": 0
                    }
                  }
                }
              ]
            },
            {
              "transform": [{"filter": {"param": "label", "empty": false}}],
              "layer": [
                {
                  "mark": {"type": "rule", "color": "gray"},
                  "encoding": {
                    "x": {"type": "ordinal", "field": "year", "aggregate": "min", "title": "Year"},
                    "tooltip": [
                        {"field": "suicide_rate", "type": "quantitative", "title": "Suicide Rate", "format": ".2f"},
                        {"field": "generation", "type": "nominal", "title": "Generation"}
                    ]
                  }
                },
                {
                  "encoding": {
                    "text": {"type": "quantitative", "field": "suicide_rate", "format": ".2f"},
                    "x": {"type": "ordinal", "field": "year"},
                    "y": {"type": "quantitative", "field": "suicide_rate", "title": "Suicide Rate"},
                    "tooltip": [
                        {"field": "suicide_rate", "type": "quantitative", "title": "Suicide Rate", "format": ".2f"},
                        {"field": "generation", "type": "nominal", "title": "Generation"}
                    ]
                  },
                  "layer": [
                    {
                      "mark": {
                        "type": "text",
                        "stroke": "white",
                        "strokeWidth": 2,
                        "align": "left",
                        "dx": 5,
                        "dy": -5
                      }
                    },
                    {
                      "mark": {"type": "text", "align": "left", "dx": 5, "dy": -5},
                      "encoding": {
                        "color": {"type": "nominal", "field": "generation"},
                        "tooltip": [
                            {"field": "suicide_rate", "type": "quantitative", "title": "Suicide Rate", "format": ".2f"},
                            {"field": "generation", "type": "nominal", "title": "Generation"}
                        ]
                      }
                    }
                  ]
                }
              ]
            }
          ]
      }
    ]
  }
  